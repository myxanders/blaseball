<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Istok+Web&display=swap" rel="stylesheet">
    <title>Blaseball Stats Demo</title>
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../myx.css" rel="stylesheet">
    <link href="blaseballstyle.css" rel="stylesheet">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="..//site.webmanifest">
    <link rel="mask-icon" href="..//safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<script type="text/javascript">
    $.ajax({
        'async': false,
        'global': false,
        'url': "ilb_pitching.json",
        'dataType': "json",
        'success': function (data) {
            arms = data;
        }
    });

    $.ajax({
        'async': false,
        'global': false,
        'url': "ilb_batting.json",
        'dataType': "json",
        'success': function (data) {
            bats = data;
        }
    });

    function ILBTeams() {
        let shorts = ['KCBM', 'CRAB', 'DALE', 'CHI', 'BOS', 'FRI', 'ATL', 'SEA', 'JAZZ', 'LIFT', 'LVRS', 'YELL', 'CORE', 'NYM', 'CAN', 'PIES', 'CHST', 'SPY', 'STK', 'HELL', 'TGRS', 'TACO', 'CDMX', 'OHWO'];
        let names = ['The Breath Mints', 'Crabs', 'Dale', 'Firefighters', 'Flowers', 'Fridays', 'Georgias', 'Garages', 'Jazz Hands', 'Lift', 'Lovers', 'Magic', 'Mechanics', 'Millennials', 'Moist Talkers', 'Pies', 'Shoe Thieves', 'Spies', 'Steaks', 'Sunbeams', 'Tigers', 'Unlimited Tacos', 'Wild Wings', 'Worms'];
        let emojis = ['0x1F36C', '0x1F980', '0x1F6A4', '0x1F525', '0x1F337', '0x1F3DD', '0x1F531', '0x1F3B8', '0x1F450', '0x1F3CB', '0x1F48B', '0x2728', '0x1F6E0', '0x1F4F1', '0x1F5E3', '0x1F967', '0x1F45F', '0x1F575', '0x1F969', '0x1F31E', '0x1F405', '0x1F32E', '0x1F357', '0x1F40C'];
        var n = document.getElementById('team');
        for (i = 0; i < 24; i++) {
            var opt = document.createElement('option');
            opt.value = shorts[i];
            opt.innerHTML = String.fromCodePoint(emojis[i]) + " " + names[i];
            n.append(opt);
        }

    }

    function chooseSzn() {
        var e = document.getElementById("year");
        var szn = e.value;
        sznData(szn);
    }

    function sznData(year) {
        var batters = bats[year];
        var pitchers = arms[year];
        var filter = document.getElementById("team").value;
        var b_tbl = document.getElementById("batting_data");
        var p_tbl = document.getElementById("pitching_data");
        b_tbl.className = 'table';
        p_tbl.className = 'table';
        if (filter != 'All') {
            batters = batters.filter(n => n.tsho.includes(filter));
            b_tbl.className += " " + filter;
            pitchers = pitchers.filter(n => n.tsho.includes(filter));
            p_tbl.className += " " + filter;
        }        
        clearTable(b_tbl);
        clearTable(p_tbl);
        displayBattingResults(b_tbl, batters);
        displayPitchingResults(p_tbl, pitchers)
    }

    function start() {
        ILBTeams();
        sznData('season23');
    }

    function clearTable(table) {
        for (x = table.rows.length - 1; x > 0; x--) {
            table.deleteRow(x);
        }
    }

    function displayBattingResults(table, data) {
        data.sort(function (a, b) {
            return a.Rank - b.Rank || a.name - b.name;
        })
        data.forEach(item => {
            let row = table.insertRow();
            let rank = row.insertCell(0);
            rank.innerHTML = item.Rank;
            let player = row.insertCell(1);
            if (item.name == 'Jos� Haley' || item.name == 'Samothes Demb�l�'){
                item.name = item.name.replace(/\uFFFD/g, 'é');
            }
            if (item.name == 'Ra�l Leal' || item.name == 'Jes�s Koch'){
                item.name = item.name.replace(/\uFFFD/g, 'ú');
            }
            if (item.name == 'Yrj� Kerfuffle'){
                item.name = item.name.replace(/\uFFFD/g, 'ö');
            }
            player.innerHTML = item.name;
            let team = row.insertCell(2);
            team.innerHTML = item.tsho;
            let rating = row.insertCell(3);
            rating.innerHTML = item.Rating;
            let pm = row.insertCell(4);
            pm.innerHTML = item.PM;
            let rm = row.insertCell(5);
            rm.innerHTML = item.RM;
            let imp = row.insertCell(6);
            imp.innerHTML = item.IMP;
            let aobp = row.insertCell(7);
            aobp.innerHTML = item.aOBP;
            let dead = row.insertCell(8);
            dead.innerHTML = item.DEAD;
        });
    }

    function displayPitchingResults(table, data) {
        data.sort(function (a, b) {
            return b.Rating - a.Rating || a.name - b.name;
        })
        data.forEach(item => {
            let row = table.insertRow();
            let rank = row.insertCell(0);
            rank.innerHTML = 1;
            let player = row.insertCell(1);
            player.innerHTML = item.name;
            let team = row.insertCell(2);
            team.innerHTML = item.tsho;
            let rating = row.insertCell(3);
            rating.innerHTML = item.Rating;
            let net = row.insertCell(4);
            net.innerHTML = item.NET;
            let qs = row.insertCell(5);
            qs.innerHTML = item['QS%'];
            let fip = row.insertCell(6);
            fip.innerHTML = item.FIP;
            let kip = row.insertCell(7);
            kip.innerHTML = item.KIP;
            let whip = row.insertCell(8);
            whip.innerHTML = item.WHIP;
        });
    }

    function toggleBatters() {
        var p = document.getElementById("pitching_table");
        p.style.display = "none";
        var pb = document.getElementById("pitching_btn");
        pb.className = pb.className.replace(" active", "");

        var b = document.getElementById("batting_table");
        b.style.display = "block";
        var bb = document.getElementById("batting_btn");
        bb.className += " active";
    }

    function togglePitchers() {
        var b = document.getElementById("batting_table");
        b.style.display = "none";
        var bb = document.getElementById("batting_btn");
        bb.className = bb.className.replace(" active", "");

        var p = document.getElementById("pitching_table");
        p.style.display = "block";
        var pb = document.getElementById("pitching_btn");
        pb.className += " active";
    }

</script>
<style>
    #exampleModal .modal-content {
        background-color: #111;
        border: 1px solid white;
    }

    #exampleMOdal .modal-dialog {
        max-width: 600px;
    }

</style>
<body onload="start()">
    <div class="container">
        <h1 class="h1 py-3 text-center" id="boop">Blaseball Advanced Stats</h1>
        <div class="row py-1 text-center">
                    <!-- Button trigger modal -->
        <button type="button" class="btn btn-link" data-toggle="modal" style="color: lightgrey; width: 100%;" data-target="#exampleModal">
            Stat Explanations & Calculations
        </button>
        </div>
        <div class="row py-4">
            <div class="col">
                <label for="team">By Team:</label>
                <select class="form-control" id="team" name="team" onchange="chooseSzn()">
                    <option value="All" selected>All Teams</option>
                </select>
            </div>
            <div class="col">
                <label for="year">Season:</label>
                <select class="form-control" id="year" name="year" onchange="chooseSzn()">
                    <option value="season23" selected>S23</option>
                    <option value="season22">S22</option>
                    <option value="season21">S21</option>
                    <option value="season20">S20</option>
                    <option value="season19">S19</option>
                    <option value="season18">S18</option>
                    <option value="season17">S17</option>
                    <option value="season16">S16</option>
                    <option value="season15">S15</option>
                    <option value="season14">S14</option>
                    <option value="season13">S13</option>
                    <option value="season12">S12</option>
                    <option value="season11">S11</option>
                    <option value="season10">S10</option>
                    <option value="season9">S9</option>
                    <option value="season8">S8</option>
                    <option value="season7">S7</option>
                    <option value="season6">S6</option>
                    <option value="season5">S5</option>
                    <option value="season4">S4</option>
                    <option value="season3">S3</option>
                </select>
            </div>
        </div>
        <div class="row pb-3">
            <div class="col">
                <button type="button" style="width:100%;" id="batting_btn"
                    class="btn btn-outline-secondary btn-lg active" onclick="toggleBatters()">Batters</button>
            </div>
            <div class="col">
                <button type="button" style="width:100%;" id="pitching_btn" class="btn btn-outline-secondary btn-lg"
                    onclick="togglePitchers()">Pitchers</button>
            </div>
        </div>
        <div class="row active" id="batting_table">
            <div class="table-responsive">
                <table class="table JAZZ" id="batting_data">
                    <thead>
                        <tr>
                            <th>ILB Rank</th>
                            <th>Player</th>
                            <th>Team</th>
                            <th>Rating</th>
                            <th>Playmaker</th>
                            <th>Runmaker</th>
                            <th>Impact</th>
                            <th>aOBP</th>
                            <th>No Play</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="row" id="pitching_table" style="display:none;">
            <div class="table-responsive">
                <table class="table" id="pitching_data">
                    <thead>
                        <tr>
                            <th>ILB Rank</th>
                            <th>Player</th>
                            <th>Team</th>
                            <th>Rating</th>
                            <th>NET</th>
                            <th>QS%</th>
                            <th>FIP</th>
                            <th>KIP</th>
                            <th>WHIP</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Advanced Stat Explanations</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true" style="color:white">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li><b>Batting Stats</b></li>
                            <ul>
                                <li>aOBP (advanced OBP): How often a player gets on base OR puts the ball in play.</li>
                                <ul>
                                    <li>Calculation: (H + BB + SACH + SACF) / PA</li>
                                </ul>
                                <li>No Play: How often a player's plate appearance ends in a deadball out.</li>
                                <ul>
                                    <li>Calculation: (SO + CS) / PA</li>
                                </ul>
                                <li>Playmaker (PM): How much more often a player's plate appearance ends in offense than it ends in no chance for offense.</li>
                                <ul>
                                    <li>Calculation: aOBP - No Play</li>
                                </ul>
                                <li>Runmaker (RM): Runs generated per plate appearance (scored or driven in).</li>
                                <ul>
                                    <li>Calculation: (R + RBI - HR) / PA</li>
                                </ul>                                
                                <li>Impact (IMP): Runs generated per plate appearance where scoring is in play.</li>
                                <ul>
                                    <li>Calculation: RM / aOBP</li>
                                </ul>                                
                            </ul>
                            <li><b>Pitching Stats</b></li>
                            <ul>
                                <li>KIP: Strikeouts per inning pitched.</li>
                                <ul>
                                    <li>Calculation: K / IP</li>
                                </ul>
                                <li>WHIP: Walks and hits per inning pitched.</li>
                                <ul>
                                    <li>Calculation: (BB + H) / IP</li>
                                </ul>
                                <li>NET: How many more strikeouts than runners on base, per inning pitched.</li>
                                <ul>
                                    <li>Calculation: KIP - WHIP</li>
                                </ul>
                                <li>QS%: How often a pitcher has a quality start.</li>
                                <ul>
                                    <li>Calculation: QS / GP</li>
                                </ul>      
                                <li>FIP (Fielding-Independent Pitching): Estimation of a pitcher's run prevention ability independent of their defense.</li>
                                <ul>
                                    <li>Calculation: ((13 x HR) + (3 x BB) - (2 x K)) / IP + <i>C</i></li>
                                    <li>C = lgERA - (((13 x lgHR) + (3 x lgBB) - (2 x lgK)) / lgIP)</li>
                                </ul>                                
                            </ul>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="../js/bootstrap.js"></script>
    </footer>
</body>